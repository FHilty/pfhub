// Generated by CoffeeScript 1.9.3
(function() {
  var add_description, add_header, add_icon, add_icons, add_logo, add_stats, build_function, data_file, icons, sort_func;

  data_file = "data/codes.json";

  add_logo = function(selection) {
    var subselection;
    subselection = selection.filter(function(d) {
      return "logo" in d;
    });
    subselection = subselection.append("img").attr("src", function(d) {
      return d.logo;
    });
    return subselection.attr("alt", "").attr("class", "circle");
  };

  add_header = function(selection) {
    var subselection;
    subselection = selection.filter(function(d) {
      return "name" in d;
    });
    subselection = subselection.append("span").attr("class", "title");
    return subselection.append("h5").text(function(d) {
      return d.name;
    });
  };

  add_description = function(selection) {
    var subselection, text;
    subselection = selection.filter(function(d) {
      return "description" in d;
    });
    text = function(d) {
      return d.description + " written in " + d.language + ".";
    };
    return subselection.append("p").text(text);
  };

  add_stats = function(selection) {
    var subselection, table, tr;
    subselection = selection.filter(function(d) {
      return "stats" in d;
    });
    subselection.append("h5").text("Stats:");
    table = subselection.append("table").attr("class", "indent");
    tr = table.selectAll().data(function(d) {
      return d.stats;
    }).enter().append("tr");
    tr.append("td").html(function(d) {
      return d.name + ":&nbsp;";
    });
    return tr.append("td").text(function(d) {
      return d.value;
    });
  };

  icons = {
    GitHub: {
      html: '<i class="fa fa-github fa-2x chimad-icon"></i>'
    },
    Home: {
      html: '<i class="fa fa-home fa-2x chimad-icon"></i>'
    },
    OpenHub: {
      html: '<img src="images/OH_logo-24x24.png" class="icon">'
    }
  };

  add_icon = function(selection) {
    var subselection;
    subselection = selection.filter(function(d) {
      return d.name in icons;
    });
    subselection.attr("href", function(d) {
      return d.url;
    });
    subselection.attr("title", function(d) {
      return d.name;
    });
    return subselection.html(function(d) {
      return icons[d.name].html;
    });
  };

  add_icons = function(selection) {
    var a, div, subselection;
    subselection = selection.filter(function(d) {
      return "links" in d;
    });
    div = subselection.append("div").attr("class", "icons");
    a = div.selectAll().data(function(d) {
      return d.links;
    }).enter().append("a");
    return add_icon(a);
  };

  sort_func = function(a, b) {
    return d3.descending(a.stats[0].value, b.stats[0].value);
  };

  build_function = function(data) {
    var selection;
    data = data.sort(sort_func);
    selection = d3.select("#codes").selectAll().data(data).enter().append("li").attr("class", "collection-item avatar light-green lighten-4");
    selection.attr("style", "border-color: transparent; border-bottom-style: none; margin-bottom: 5px;");
    selection = selection.sort();
    add_logo(selection);
    add_header(selection);
    return add_description(selection);
  };

  d3.json(data_file, build_function);

}).call(this);
